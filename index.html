<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LineMaker</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>LineMaker</h1>
        <p>A collection of tools for CNC pen plotting enthusiasts</p>
      </header>

      <main>
        <div class="main-layout">
          <div class="tools-section">
            <div class="tools-grid">
              <div class="tool-card">
                <div class="tool-icon">
                  <svg
                    width="64"
                    height="64"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2.5"
                  >
                    <!-- Bold diagonal hatching pattern -->
                    <path d="M4 4 L20 20" stroke-width="3" />
                    <path d="M2 8 L16 22" stroke-width="2" />
                    <path d="M8 2 L22 16" stroke-width="2" />
                    <path d="M6 6 L18 18" stroke-width="1.5" />
                    <path d="M10 10 L14 14" stroke-width="1.5" />
                    <!-- Cross-hatching -->
                    <path d="M4 20 L20 4" stroke-width="2.5" />
                    <path d="M2 16 L16 2" stroke-width="1.5" />
                    <path d="M8 22 L22 8" stroke-width="1.5" />
                  </svg>
                </div>
                <h2>HatchMaker</h2>
                <p>
                  Convert images to pen plotter-friendly line art using hatching
                  patterns. Generate SVG and G-code output for your CNC or pen
                  plotter.
                </p>
                <div class="tool-features">
                  <span class="feature">Image to Lines</span>
                  <span class="feature">G-code Export</span>
                  <span class="feature">SVG Output</span>
                </div>
                <a href="hatchmaker/index.html" class="tool-link"
                  >Open HatchMaker</a
                >
              </div>

              <div class="tool-card">
                <div class="tool-icon">
                  <svg
                    width="64"
                    height="64"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2.5"
                  >
                    <!-- Multiple overlapping hatching layers for moiré effect -->
                    <g opacity="0.8">
                      <path d="M3 3 L21 21" stroke-width="2.5" />
                      <path d="M1 7 L19 25" stroke-width="2" />
                      <path d="M7 1 L25 19" stroke-width="2" />
                    </g>
                    <g opacity="0.6" transform="rotate(15 12 12)">
                      <path d="M3 3 L21 21" stroke-width="2" />
                      <path d="M1 7 L19 25" stroke-width="1.5" />
                      <path d="M7 1 L25 19" stroke-width="1.5" />
                    </g>
                    <g opacity="0.4" transform="rotate(30 12 12)">
                      <path d="M3 3 L21 21" stroke-width="1.5" />
                      <path d="M1 7 L19 25" stroke-width="1" />
                      <path d="M7 1 L25 19" stroke-width="1" />
                    </g>
                  </svg>
                </div>
                <h2>HatchMoiréMaker</h2>
                <p>
                  Create stunning moiré effects by overlaying multiple hatched
                  layers with adjustable offset, angle, and skew parameters for
                  each layer.
                </p>
                <div class="tool-features">
                  <span class="feature">Multiple Layers</span>
                  <span class="feature">Moiré Effects</span>
                  <span class="feature">G-code Export</span>
                  <span class="feature">SVG Output</span>
                </div>
                <a href="moiremaker/index.html" class="tool-link"
                  >Open HatchMoiréMaker</a
                >
              </div>

              <div class="tool-card">
                <div class="tool-icon">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2 C12 2 8 12 22 12"/>
                        <path d="M12 22 C12 22 16 12 2 12"/>
                        <circle cx="12" cy="12" r="3" fill="currentColor"/>
                    </svg>
                </div>
                <h2>FieldLines</h2>
                <p>Create generative art by placing attractor and repulsor points on a canvas to influence a field of lines.</p>
                <div class="tool-features">
                    <span class="feature">Generative Art</span>
                    <span class="feature">Interactive</span>
                    <span class="feature">SVG Export</span>
                </div>
                <a href="fieldlines/index.html" class="tool-link">Open FieldLines</a>
              </div>
            </div>
          </div>

          <aside class="recent-projects-section">
            <h2>Recent Projects</h2>
            <div class="recent-projects-list" id="recentProjectsList">
              <div class="no-projects-message">
                <svg
                  width="48"
                  height="48"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.5"
                >
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                  <line x1="16" y1="2" x2="16" y2="6" />
                  <line x1="8" y1="2" x2="8" y2="6" />
                  <line x1="3" y1="10" x2="21" y2="10" />
                </svg>
                <p>No saved projects yet</p>
                <small>Create and save projects to see them here</small>
              </div>
            </div>
          </aside>
        </div>
      </main>
    </div>

    <script src="configManager.js"></script>
    <script>
      class HomePage {
        constructor() {
          this.configManager = new ConfigManager();
          this.loadRecentProjects();
        }

        loadRecentProjects() {
          // Get the last 10 recent configurations across all tools
          const recentProjects = this.configManager.getRecentConfigs(10);
          this.displayRecentProjects(recentProjects);
        }

        displayRecentProjects(projects) {
          const container = document.getElementById("recentProjectsList");

          if (!container) {
            console.error("Recent projects container not found");
            return;
          }

          if (projects.length === 0) {
            // Show the "no projects" message (already in HTML)
            return;
          }

          // Clear container and add recent projects
          container.innerHTML = "";

          projects.forEach((project) => {
            const projectItem = this.createProjectItem(project);
            container.appendChild(projectItem);
          });
        }

        createProjectItem(project) {
          const item = document.createElement("div");
          item.className = "recent-project-item";

          const toolName = this.getToolDisplayName(project.toolId);
          const date = new Date(project.timestamp).toLocaleDateString();
          const time = new Date(project.timestamp).toLocaleTimeString([], {
            hour: "2-digit",
            minute: "2-digit",
          });

          // Escape HTML to prevent XSS
          const safeName = this.escapeHtml(project.name);
          const safeToolName = this.escapeHtml(toolName);

          item.innerHTML = `
                    <div class="project-thumbnail">
                        <img src="${project.base64Image}" alt="${safeName}" loading="lazy" onerror="this.style.display='none'">
                    </div>
                    <div class="project-info">
                        <div class="project-name">${safeName}</div>
                        <div class="project-tool">${safeToolName}</div>
                        <div class="project-date">${date} ${time}</div>
                    </div>
                `;

          // Add click handler to open the project
          item.addEventListener("click", () => {
            this.openProject(project);
          });

          return item;
        }

        getToolDisplayName(toolId) {
          const toolNames = {
            hatchmaker: "HatchMaker",
            moiremaker: "HatchMoiréMaker",
          };
          return toolNames[toolId] || toolId;
        }

        escapeHtml(text) {
          const div = document.createElement("div");
          div.textContent = text;
          return div.innerHTML;
        }

        openProject(project) {
          // Construct the URL with config parameter
          const toolUrl = `${project.toolId}/index.html?loadConfig=${project.id}`;
          window.location.href = toolUrl;
        }
      }

      // Initialize homepage when DOM is loaded
      document.addEventListener("DOMContentLoaded", () => {
        new HomePage();
      });
    </script>
  </body>
</html>
